{% extends "base.html" %}

{% load static %}

{% block style %}
  <link rel="stylesheet" href="{% static "diaries/style.css" %}">
{% endblock style %}

{% block content %}
  <h1>일기장</h1>

  {% if user.is_authenticated %}
    <a href="{% url "diaries:create" %}">[일기 쓰기]</a>
    <a href="{% url "accounts:logout" %}">[LOGOUT]</a>
  {% else %}
    <a href="{% url "accounts:login" %}">[LOGIN]</a>
    <a href="{% url "accounts:signup" %}">[SIGNUP]</a>
  {% endif %}

  <ul class="diaries">
    {% for diary in diaries %}
    <article class="diaries-main">
      <li>
        <p>작성자 : {{ diary.user.username}}</p>
        <p>작성일 : {{ diary.created_at|date:"F d, Y, g:i a." }}</p>
        {% if diary.picture %}
          <img src="{{ diary.picture.url }}" alt="{{ diary.picture }}">
        {% else %}
          <img src="{% static "diaries/default.png" %}" alt="{{ diary.picture }}">
        {% endif %}
        <p>{{ diary.content }}</p>
      </li>
      
      {% if user.is_authenticated %}
        <form action="{% url "diaries:like" diary.pk %}" method="POST" style="display: inline;">
          {% csrf_token %}
          <button type="submit">
            {% if user in diary.like_users.all %}
              ♥
            {% else %}
              ♡
            {% endif %}
          </button>
        </form>
        <span>{{ diary.like_user.count }}</span>
      {% endif %}

      <section class="diaries-comment">
        <ul>
          {% for comment in diary.comment_set.all %}
            <li>
              <span>{{ comment.user.username }} | {{ comment.content }}</span>
              {% if user == comment.user %}
                <form action="{% url "diaries:comments_delete" comment.pk %}" method="POST">
                  {% csrf_token %}
                  <input type="submit" value="댓글 삭제">
                </form>
              {% endif %}
            </li>
          {% empty %}
            <li>
              <span>첫 번째 댓글을 작성해보세요.</span>
            </li>
          {% endfor %}
        </ul>

        {% if user.is_authenticated %}
        <form action="{% url "diaries:comments_create" diary.pk %}" method="POST">
          {% csrf_token %}
          {{ comment_form.as_p }}
          <input type="submit" value="댓글 생성">
        </form>
        {% endif %}
      </section>
      
    </article>
    {% empty %}
      <li>아직 작성한 일기가 없습니다.</li>
    {% endfor %}
  </ul>
{% endblock content %}